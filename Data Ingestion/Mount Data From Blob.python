{"version":"NotebookV1","origId":3406443095179071,"name":"Mount Data From Blob","language":"python","commands":[{"version":"CommandV1","origId":3406443095179072,"guid":"781fd03f-496d-4ceb-a7e8-64da882b3654","subtype":"command","commandType":"auto","position":1.0,"command":"%md\n##### Define shared methods for mount files from Azure Storage Blob","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1538036212952,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rakeshr@microsoft.com","latestUserId":"1985061792949798","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c831d1ba-3cdd-4e27-a9d1-6bda6d482e8e"},{"version":"CommandV1","origId":3406443095179073,"guid":"02b41c5c-a83c-4589-9445-56d19e2ad336","subtype":"command","commandType":"auto","position":2.0,"command":"def mount_folder(source, extraConfigs, mountPoint) :\n  try:\n    dbutils.fs.mount(source=source,mount_point=mountPoint,extra_configs=extraConfigs)\n    return True\n  except:\n    raise\n  \n      ","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1541439174713,"submitTime":1541439174688,"finishTime":1541439174726,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rakeshr@microsoft.com","latestUserId":"1985061792949798","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6095e9de-9a20-4d37-8dc0-b9c056c66574"},{"version":"CommandV1","origId":3406443095179074,"guid":"981dd7ae-130c-4599-be09-ecfc81c3adb0","subtype":"command","commandType":"auto","position":2.5,"command":"def mount_exists(mountPoint) :\n  try:\n    files = dbutils.fs.ls(mountPoint)\n    return True if len(files)>0 else False\n  except:\n    return False\n  ","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">SyntaxError</span><span class=\"ansired\">:</span> invalid syntax","error":"<div class=\"ansiout\"><span class=\"ansicyan\">  File </span><span class=\"ansigreen\">&quot;&lt;command-32333816544476&gt;&quot;</span><span class=\"ansicyan\">, line </span><span class=\"ansigreen\">4</span>\n<span class=\"ansiyellow\">    return True if len(files)&gt;0</span>\n<span class=\"ansigrey\">                               ^</span>\n<span class=\"ansired\">SyntaxError</span><span class=\"ansired\">:</span> invalid syntax\n</div>","workflows":[],"startTime":1541439172353,"submitTime":1541439172322,"finishTime":1541439172368,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rakeshr@microsoft.com","latestUserId":"1985061792949798","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4664403b-950a-4094-843d-6f1535181dc3"},{"version":"CommandV1","origId":3406443095179075,"guid":"32aa179d-dee1-45a8-b08b-ad402a6e63ef","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n\n##### Defining variables required for mounting from blob\nCurrently these are hardcoded, to be changed in following sprint when the Keyvault is configured","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1538036213868,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rakeshr@microsoft.com","latestUserId":"1985061792949798","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7fb14aa1-3407-4aea-9cda-68436090438c"},{"version":"CommandV1","origId":3406443095179076,"guid":"b835bb8e-056e-468c-9e64-27e1409362a7","subtype":"command","commandType":"auto","position":4.0,"command":"#Storage account and key\nstorage_account_name = \"\"\nstorage_account_access_key = \"\"\n","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1541439110366,"submitTime":1541439110338,"finishTime":1541439110404,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rakeshr@microsoft.com","latestUserId":"1985061792949798","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"514ae254-fa39-4b9c-980d-fc43af674dc1"},{"version":"CommandV1","origId":3406443095179077,"guid":"6f874243-56da-4b80-b204-bb0ba40e80af","subtype":"command","commandType":"auto","position":4.5,"command":"%md\n#### Mount the staging folder and config","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1538036214466,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rakeshr@microsoft.com","latestUserId":"1985061792949798","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c875e19f-c0b0-4e39-ad73-6d3d4ea351ed"},{"version":"CommandV1","origId":3406443095179078,"guid":"83379880-8811-43e1-8a97-77eaf196cde5","subtype":"command","commandType":"auto","position":5.0,"command":"configs = {\"fs.azure.account.key.\"+storage_account_name+\".blob.core.windows.net\" : storage_account_access_key}\n#Mount Staging foder\nif (mount_exists(\"/mnt/blobstorage/stage\")==False):\n  mount_folder(\"wasbs://<<stagefolder>>@\"+storage_account_name+\".blob.core.windows.net\",configs,\"/mnt/blobstorage/stage\")\nelse:\n  print(\"Mount name /mnt/blobstorage/stage already exists\")\n#Mount config foder from config container\nif (mount_exists(\"/mnt/blobstorage/config\")==False):\n  mount_folder(\"wasbs://<<config>>@\"+storage_account_name+\".blob.core.windows.net\",configs,\"/mnt/blobstorage/config\")\nelse:\n  print(\"Mount name /mnt/blobstorage/config already exists\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;MountFolder&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-1525553771150108&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      2</span> <span class=\"ansired\">#Mount Staging foder from rhea-unload container</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      3</span> <span class=\"ansigreen\">if</span> <span class=\"ansiyellow\">(</span>mount_exists<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;/mnt/blobstorage/stage&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">==</span><span class=\"ansigreen\">False</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 4</span><span class=\"ansiyellow\">   </span>MountFolder<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;wasbs://rhea-unload@&quot;</span><span class=\"ansiyellow\">+</span>storage_account_name<span class=\"ansiyellow\">+</span><span class=\"ansiblue\">&quot;.blob.core.windows.net&quot;</span><span class=\"ansiyellow\">,</span>configs<span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&quot;/mnt/blobstorage/stage&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      5</span> <span class=\"ansigreen\">else</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      6</span>   print<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;Mount name /mnt/blobstorage/stage already exists&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;MountFolder&apos; is not defined</div>","workflows":[],"startTime":1538036215874,"submitTime":1538036214775,"finishTime":1538036257964,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rakeshr@microsoft.com","latestUserId":"1985061792949798","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"70701e5f-07d0-45c2-9c5d-bc605ba7832d"},{"version":"CommandV1","origId":3406443095179080,"guid":"62cea383-220a-4b85-b932-a1f63112eb72","subtype":"command","commandType":"auto","position":5.5,"command":"%md\n#### Mount the Data Lake Store","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1538036215077,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rakeshr@microsoft.com","latestUserId":"1985061792949798","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7fb185a2-3594-47c5-afca-f01b5bfdbb89"},{"version":"CommandV1","origId":3406443095179081,"guid":"a92240ec-49d1-4d37-9e58-20fc8e1c88a6","subtype":"command","commandType":"auto","position":6.0,"command":"configs = {\"dfs.adls.oauth2.access.token.provider.type\": \"ClientCredential\",\n           \"dfs.adls.oauth2.client.id\": \"\",\n           \"dfs.adls.oauth2.credential\": \"\",\n           \"dfs.adls.oauth2.refresh.url\": \"https://login.microsoftonline.com/<<TenantId>>/oauth2/token\"}\nif (mount_exists(\"/mnt/datalake\")==False):\n  mount_folder(\"adl://<<adlaccount>>.azuredatalakestore.net/sites\",configs,\"/mnt/datalake\")\nelse:\n  print(\"Mount name /mnt/datalake already exists\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1538037408526,"submitTime":1538037408456,"finishTime":1538037429321,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rakeshr@microsoft.com","latestUserId":"1985061792949798","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7d9612f0-f4a4-4522-8d5c-3f373e90edd3"},{"version":"CommandV1","origId":3406443095179083,"guid":"9430bf26-fe7b-4c0b-b17f-5a7a845d486e","subtype":"command","commandType":"auto","position":17.0,"command":"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4c468979-a4dd-4105-aaa2-8a5cf737ac7e"}],"dashboards":[],"guid":"94fe4dbe-9ffa-4062-814e-e0ad86640980","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}